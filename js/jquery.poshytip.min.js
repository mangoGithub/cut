/*
 * Poshy Tip jQuery plugin v1.2
 * http://vadikom.com/tools/poshy-tip-jquery-plugin-for-stylish-tooltips/
 * Copyright 2010-2013, Vasil Dinkov, http://vadikom.com/
 */
(function(e){var a=[],d=/^url\(["']?([^"'\)]*)["']?\);?$/i,c=/\.png$/i,b=!!window.createPopup&&document.documentElement.currentStyle.minWidth=="undefined";function f(){e.each(a,function(){this.refresh(true)})}e(window).resize(f);e.Poshytip=function(h,g){this.$elm=e(h);this.opts=e.extend({},e.fn.poshytip.defaults,g);this.$tip=e(['<div class="',this.opts.className,'">','<div class="tip-inner tip-bg-image"></div>','<div class="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left"></div>',"</div>"].join("")).appendTo(document.body);this.$arrow=this.$tip.find("div.tip-arrow");this.$inner=this.$tip.find("div.tip-inner");this.disabled=false;this.content=null;this.init()};e.Poshytip.prototype={init:function(){a.push(this);var g=this.$elm.attr("title");this.$elm.data("title.poshytip",g!==undefined?g:null).data("poshytip",this);if(this.opts.showOn!="none"){this.$elm.bind({"mouseenter.poshytip":e.proxy(this.mouseenter,this),"mouseleave.poshytip":e.proxy(this.mouseleave,this)});switch(this.opts.showOn){case"hover":if(this.opts.alignTo=="cursor"){this.$elm.bind("mousemove.poshytip",e.proxy(this.mousemove,this))}if(this.opts.allowTipHover){this.$tip.hover(e.proxy(this.clearTimeouts,this),e.proxy(this.mouseleave,this))}break;case"focus":this.$elm.bind({"focus.poshytip":e.proxy(this.showDelayed,this),"blur.poshytip":e.proxy(this.hideDelayed,this)});break}}},mouseenter:function(g){if(this.disabled){return true}this.$elm.attr("title","");if(this.opts.showOn=="focus"){return true}this.showDelayed()},mouseleave:function(g){if(this.disabled||this.asyncAnimating&&(this.$tip[0]===g.relatedTarget||jQuery.contains(this.$tip[0],g.relatedTarget))){return true}if(!this.$tip.data("active")){var h=this.$elm.data("title.poshytip");if(h!==null){this.$elm.attr("title",h)}}if(this.opts.showOn=="focus"){return true}this.hideDelayed()},mousemove:function(g){if(this.disabled){return true}this.eventX=g.pageX;this.eventY=g.pageY;if(this.opts.followCursor&&this.$tip.data("active")){this.calcPos();this.$tip.css({left:this.pos.l,top:this.pos.t});if(this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow}}},show:function(){if(this.disabled||this.$tip.data("active")){return}this.reset();this.update();if(!this.content){return}this.display();if(this.opts.timeOnScreen){this.hideDelayed(this.opts.timeOnScreen)}},showDelayed:function(g){this.clearTimeouts();this.showTimeout=setTimeout(e.proxy(this.show,this),typeof g=="number"?g:this.opts.showTimeout)},hide:function(){if(this.disabled||!this.$tip.data("active")){return}this.display(true)},hideDelayed:function(g){this.clearTimeouts();this.hideTimeout=setTimeout(e.proxy(this.hide,this),typeof g=="number"?g:this.opts.hideTimeout)},reset:function(){this.$tip.queue([]).detach().css("visibility","hidden").data("active",false);this.$inner.find("*").poshytip("hide");if(this.opts.fade){this.$tip.css("opacity",this.opacity)}this.$arrow[0].className="tip-arrow tip-arrow-top tip-arrow-right tip-arrow-bottom tip-arrow-left";this.asyncAnimating=false},update:function(j,k){if(this.disabled){return}var i=j!==undefined;if(i){if(!k){this.opts.content=j}if(!this.$tip.data("active")){return}}else{j=this.opts.content}var h=this,g=typeof j=="function"?j.call(this.$elm[0],function(l){h.update(l)}):j=="[title]"?this.$elm.data("title.poshytip"):j;if(this.content!==g){this.$inner.empty().append(g);this.content=g}this.refresh(i)},refresh:function(h){if(this.disabled){return}if(h){if(!this.$tip.data("active")){return}var k={left:this.$tip.css("left"),top:this.$tip.css("top")}}this.$tip.css({left:0,top:0}).appendTo(document.body);if(this.opacity===undefined){this.opacity=this.$tip.css("opacity")}var l=this.$tip.css("background-image").match(d),m=this.$arrow.css("background-image").match(d);if(l){var i=c.test(l[1]);if(b&&i){this.$tip.css("background-image","none");this.$inner.css({margin:0,border:0,padding:0});l=i=false}else{this.$tip.prepend('<table class="tip-table" border="0" cellpadding="0" cellspacing="0"><tr><td class="tip-top tip-bg-image" colspan="2"><span></span></td><td class="tip-right tip-bg-image" rowspan="2"><span></span></td></tr><tr><td class="tip-left tip-bg-image" rowspan="2"><span></span></td><td></td></tr><tr><td class="tip-bottom tip-bg-image" colspan="2"><span></span></td></tr></table>').css({border:0,padding:0,"background-image":"none","background-color":"transparent"}).find(".tip-bg-image").css("background-image",'url("'+l[1]+'")').end().find("td").eq(3).append(this.$inner)}if(i&&!e.support.opacity){this.opts.fade=false}}if(m&&!e.support.opacity){if(b&&c.test(m[1])){m=false;this.$arrow.css("background-image","none")}this.opts.fade=false}var o=this.$tip.find("> table.tip-table");if(b){this.$tip[0].style.width="";o.width("auto").find("td").eq(3).width("auto");var n=this.$tip.width(),j=parseInt(this.$tip.css("min-width")),g=parseInt(this.$tip.css("max-width"));if(!isNaN(j)&&n<j){n=j}else{if(!isNaN(g)&&n>g){n=g}}this.$tip.add(o).width(n).eq(0).find("td").eq(3).width("100%")}else{if(o[0]){o.width("auto").find("td").eq(3).width("auto").end().end().width(document.defaultView&&document.defaultView.getComputedStyle&&parseFloat(document.defaultView.getComputedStyle(this.$tip[0],null).width)||this.$tip.width()).find("td").eq(3).width("100%")}}this.tipOuterW=this.$tip.outerWidth();this.tipOuterH=this.$tip.outerHeight();this.calcPos();if(m&&this.pos.arrow){this.$arrow[0].className="tip-arrow tip-arrow-"+this.pos.arrow;this.$arrow.css("visibility","inherit")}if(h&&this.opts.refreshAniDuration){this.asyncAnimating=true;var p=this;this.$tip.css(k).animate({left:this.pos.l,top:this.pos.t},this.opts.refreshAniDuration,function(){p.asyncAnimating=false})}else{this.$tip.css({left:this.pos.l,top:this.pos.t})}},display:function(h){var i=this.$tip.data("active");if(i&&!h||!i&&h){return}this.$tip.stop();if((this.opts.slide&&this.pos.arrow||this.opts.fade)&&(h&&this.opts.hideAniDuration||!h&&this.opts.showAniDuration)){var n={},m={};if(this.opts.slide&&this.pos.arrow){var l,g;if(this.pos.arrow=="bottom"||this.pos.arrow=="top"){l="top";g="bottom"}else{l="left";g="right"}var k=parseInt(this.$tip.css(l));n[l]=k+(h?0:(this.pos.arrow==g?-this.opts.slideOffset:this.opts.slideOffset));m[l]=k+(h?(this.pos.arrow==g?this.opts.slideOffset:-this.opts.slideOffset):0)+"px"}if(this.opts.fade){n.opacity=h?this.$tip.css("opacity"):0;m.opacity=h?0:this.opacity}this.$tip.css(n).animate(m,this.opts[h?"hideAniDuration":"showAniDuration"])}h?this.$tip.queue(e.proxy(this.reset,this)):this.$tip.css("visibility","inherit");if(i){var j=this.$elm.data("title.poshytip");if(j!==null){this.$elm.attr("title",j)}}this.$tip.data("active",!i)},disable:function(){this.reset();this.disabled=true},enable:function(){this.disabled=false},destroy:function(){this.reset();this.$tip.remove();delete this.$tip;this.content=null;this.$elm.unbind(".poshytip").removeData("title.poshytip").removeData("poshytip");a.splice(e.inArray(this,a),1)},clearTimeouts:function(){if(this.showTimeout){clearTimeout(this.showTimeout);this.showTimeout=0}if(this.hideTimeout){clearTimeout(this.hideTimeout);this.hideTimeout=0}},calcPos:function(){var n={l:0,t:0,arrow:""},h=e(window),k={l:h.scrollLeft(),t:h.scrollTop(),w:h.width(),h:h.height()},p,j,m,i,q,g;if(this.opts.alignTo=="cursor"){p=j=m=this.eventX;i=q=g=this.eventY}else{var o=this.$elm.offset(),l={l:o.left,t:o.top,w:this.$elm.outerWidth(),h:this.$elm.outerHeight()};p=l.l+(this.opts.alignX!="inner-right"?0:l.w);j=p+Math.floor(l.w/2);m=p+(this.opts.alignX!="inner-left"?l.w:0);i=l.t+(this.opts.alignY!="inner-bottom"?0:l.h);q=i+Math.floor(l.h/2);g=i+(this.opts.alignY!="inner-top"?l.h:0)}switch(this.opts.alignX){case"right":case"inner-left":n.l=m+this.opts.offsetX;if(this.opts.keepInViewport&&n.l+this.tipOuterW>k.l+k.w){n.l=k.l+k.w-this.tipOuterW}if(this.opts.alignX=="right"||this.opts.alignY=="center"){n.arrow="left"}break;case"center":n.l=j-Math.floor(this.tipOuterW/2);if(this.opts.keepInViewport){if(n.l+this.tipOuterW>k.l+k.w){n.l=k.l+k.w-this.tipOuterW}else{if(n.l<k.l){n.l=k.l}}}break;default:n.l=p-this.tipOuterW-this.opts.offsetX;if(this.opts.keepInViewport&&n.l<k.l){n.l=k.l}if(this.opts.alignX=="left"||this.opts.alignY=="center"){n.arrow="right"}}switch(this.opts.alignY){case"bottom":case"inner-top":n.t=g+this.opts.offsetY;if(!n.arrow||this.opts.alignTo=="cursor"){n.arrow="top"}if(this.opts.keepInViewport&&n.t+this.tipOuterH>k.t+k.h){n.t=i-this.tipOuterH-this.opts.offsetY;if(n.arrow=="top"){n.arrow="bottom"}}break;case"center":n.t=q-Math.floor(this.tipOuterH/2);if(this.opts.keepInViewport){if(n.t+this.tipOuterH>k.t+k.h){n.t=k.t+k.h-this.tipOuterH}else{if(n.t<k.t){n.t=k.t}}}break;default:n.t=i-this.tipOuterH-this.opts.offsetY;if(!n.arrow||this.opts.alignTo=="cursor"){n.arrow="bottom"}if(this.opts.keepInViewport&&n.t<k.t){n.t=g+this.opts.offsetY;if(n.arrow=="bottom"){n.arrow="top"}}}this.pos=n}};e.fn.poshytip=function(h){if(typeof h=="string"){var g=arguments,l=h;Array.prototype.shift.call(g);if(l=="destroy"){this.die?this.die("mouseenter.poshytip").die("focus.poshytip"):e(document).undelegate(this.selector,"mouseenter.poshytip").undelegate(this.selector,"focus.poshytip")}return this.each(function(){var m=e(this).data("poshytip");if(m&&m[l]){m[l].apply(m,g)}})}var j=e.extend({},e.fn.poshytip.defaults,h);if(j.liveEvents&&j.showOn!="none"){var i,k=e.extend({},j,{liveEvents:false});switch(j.showOn){case"hover":i=function(){var m=e(this);if(!m.data("poshytip")){m.poshytip(k).poshytip("mouseenter")}};this.live?this.live("mouseenter.poshytip",i):e(document).delegate(this.selector,"mouseenter.poshytip",i);break;case"focus":i=function(){var m=e(this);if(!m.data("poshytip")){m.poshytip(k).poshytip("showDelayed")}};this.live?this.live("focus.poshytip",i):e(document).delegate(this.selector,"focus.poshytip",i);break}return this}return this.each(function(){new e.Poshytip(this,j)})};e.fn.poshytip.defaults={content:"[title]",className:"tip-yellow",bgImageFrameSize:10,showTimeout:500,hideTimeout:100,timeOnScreen:0,showOn:"hover",liveEvents:false,alignTo:"cursor",alignX:"right",alignY:"top",offsetX:-22,offsetY:18,keepInViewport:true,allowTipHover:true,followCursor:false,fade:true,slide:true,slideOffset:8,showAniDuration:300,hideAniDuration:300,refreshAniDuration:200}})(jQuery);
(function($){
  $.fn.Validator=function(config){
    var config = $.extend(true,{IsValidate:true,hmsg:"",showok:{show:true,showclass:"tip-ok"},style:{className:'tip-info',alignX:'right',alignY:'center',offsetX:8,showOn:"none",alignTo:'target',keepInViewport:false},div:false},config);
    config.rmsg=config.rmsg?config.rmsg:$.fn.Validator.enumeration.meassage[config.regexp];
    config.fnmsg=config.fnmsg?config.fnmsg:$.fn.Validator.enumeration.meassage[config.fn];
    config.regexp=$.fn.Validator.enumeration[config.regexp]?$.fn.Validator.enumeration[config.regexp]:config.regexp;
    config.fn=$.fn.Validator.enumeration[config.fn]?$.fn.Validator.enumeration[config.fn]:config.fn;
    return this.each(function(){
      var $this=$(this).poshytip(config.style);
      var $tip=$this.data('poshytip').$tip;
      $this.bind("focus",function(){
        $tip.removeClass().addClass("tip-info");
        $this.removeClass("error").addClass("focus").poshytip('hide').poshytip('update', config.hmsg).poshytip('show');
      }).bind("blur",function(event,tag){
        if(config.div && !tag){return false;}
        var v=false;
        var errormsg;
        var value=$this.removeClass("error").removeClass("focus").poshytip('hide').val();
        if(config.IsValidate && !$.trim(value)){
          errormsg=config.emsg;
        }else if($.trim(value) && config.regexp && !config.regexp.test(value)){
          errormsg=config.rmsg;
        }else if(config.fn && !config.fn(value,tag)){
          errormsg=config.fnmsg;
        }else{
          v= true;
        }
        if(v){
          if($.trim(value) && config.showok.show){
            $tip.removeClass().addClass(config.showok.showclass);
            $this.poshytip('update','<div class="tip-state"></div>').poshytip('show');
          }
        }else{
          $tip.removeClass().addClass("tip-error");
          $this.addClass("error").poshytip('update','<div class="tip-state">'+errormsg+'</div>').poshytip('show');
        }
        $this.data("Validator",v);
      });
    })
  }
  $.fn.Validator.enumeration={
    username:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$|^1[3,4,5,7,8]{1}[0-9]{9}$/,
    phone:/^1[3,4,5,7,8]{1}[0-9]{9}$/,
    email:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,
    password:/^\S{6,}$/,
    //password:/^(?!\d+$)(?![a-zA-Z]+$)[0-9a-zA-Z]{6,16}$/,
    nickname:/^[A-Za-z0-9\u4E00-\u9FA5]+$/,
    identity:/^\d{17}[\d,x,X]$/,
    bankcard:/^\d{16,19}$/,
    chinname:/^[\u4E00-\u9FA5]{2,5}(?:·[\u4E00-\u9FA5]{2,5})*$/,
    meassage:{
      username:"手机或邮箱格式错误",
      phone:"请输入正确手机号",
      email:"邮箱格式有误",
      password:"密码格式错误",
      nickname:"昵称只能用中文、英文、数字组合",
      identity:"身份证格式错误",
      checkIdCard:"身份证号码错误",
      bankcard:"银行卡格式错误",
      chinname:"中文姓名格式有误"
    },
    checkIdCard:function(idCard){
      idCard=idCard.toUpperCase(); 
      var area={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",  
            23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",  
            41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",  
            52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",  
            71:"台湾",81:"香港",82:"澳门",91:"国外"}
      var Y, JYM;
      var S, M;
      var idcard_array = new Array();  
      idcard_array = idCard.split("");
      if(18!=idCard.length){
        return false;
      }
      if(area[parseInt(idCard.substr(0, 2))] == null){
        return false;  
      }
      if(parseInt(idCard.substr(6, 4)) % 4 == 0 || (parseInt(idCard.substr(6, 4)) % 100 == 0 && parseInt(idCard.substr(6, 4)) % 4 == 0)){  
        ereg = /^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}[0-9Xx]$/; //闰年出生日期的合法性正则表达式   
      }else{
        ereg = /^[1-9][0-9]{5}19[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]{3}[0-9Xx]$/; //平年出生日期的合法性正则表达式   
      }
      if(ereg.test(idCard)){//测试出生日期的合法性
        //计算校验位
        S = (parseInt(idcard_array[0]) + parseInt(idcard_array[10])) * 7  
            + (parseInt(idcard_array[1]) + parseInt(idcard_array[11]))* 9  
            + (parseInt(idcard_array[2]) + parseInt(idcard_array[12]))* 10  
            + (parseInt(idcard_array[3]) + parseInt(idcard_array[13]))* 5  
            + (parseInt(idcard_array[4]) + parseInt(idcard_array[14]))* 8  
            + (parseInt(idcard_array[5]) + parseInt(idcard_array[15]))* 4  
            + (parseInt(idcard_array[6]) + parseInt(idcard_array[16]))* 2  
            + parseInt(idcard_array[7]) * 1  
            + parseInt(idcard_array[8]) * 6   
            + parseInt(idcard_array[9]) * 3;  
        Y = S % 11;
        M = "F";
        JYM = "10X98765432";  
        M = JYM.substr(Y, 1); //判断校验位
        if (M != idcard_array[17]){
          return false;
        }
      }else{
        return false;
      }
      var year =  idCard.substring(6,10);
      var month = idCard.substring(10,12);
      var day = idCard.substring(12,14);
      var temp_date = new Date(year,parseFloat(month)-1,parseFloat(day));   
      if(temp_date.getFullYear()!=parseFloat(year)||temp_date.getMonth()!=parseFloat(month)-1||temp_date.getDate()!=parseFloat(day)){
        return false;
      }
      return true;
    }
  }
})(jQuery)

function Validator(obj){
  var isSubmit = true;
  obj.each(function(){
    if(!$(this).trigger("blur",[1]).data("Validator")){
      isSubmit=false;
    }
  })
  return isSubmit;
}
function djs(obj,time,callback){
  var tint;
  time=time || 60;
  obj.addClass("ps_btn_1dis").text(time+' 秒后重新获得').poshytip({className:'tip-info z2010',alignX:'right',alignY:'center',offsetX:20,showOn:"none",alignTo:'target'}).poshytip('update','校验码已发送到您的手机，请注意查收').poshytip('show');
  var tip=obj.data('poshytip').$tip;
  tint=setInterval(function(){
    time--;
    //tip.find(".tip-inner").text(''+time+' 秒后重新获得');
		obj.text(time+' 秒后重新获得')
    if(time==0){
      obj.removeClass("ps_btn_1dis").text("免费获取验证码").poshytip('hide');
      clearInterval(tint);
      callback && callback();
    }
  },1000)
  return tint
}
function openTipsError(id,errorMsg)
{
  var $tip=id.data('poshytip').$tip.removeClass().addClass("tip-error");
  if($(".myDialog").is(":visible")){
    $tip.addClass("z2010");
  }
  id.poshytip('update','<div class="tip-state">'+errorMsg+'</div>').poshytip('show');
}